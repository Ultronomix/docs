# SQL
SQL, or Structured Query Language, is a declarative (focused on defining outcomes over procedure) domain-specific (focused on one job) programming language used to command relational databases.

## Terminology

**RDBMS** 
- Relational Database Management System, relational referring to relational data (i.e. tables).


**Table**
- A collection of related data held in a table format within a database. 
- It consists of columns and rows.


**Column**
- a set of data values of a particular simple type, one value for each row of the database 
- Also known as "attributes"


**Row**
- Represents a single, implicitly structured data item in a table
- Also known as "records", "entries", or "tuples"


**Schema** 
- Similar packages/namespaces, groupings of tables expressing some database logical structure.


**SQL dialects** 
- Though SQL is an ANSI-standardized language, its specification is defined in such a way that RDBMS vendors (such as PostGreSQL, Oracle, etc.) have their own "dialects" of SQL. For the most post (at a basic level) are nearly the same, with some minor syntax/keyword differences.


**Primary Key** 
- Unique (in that table), non-null candidate key.


**Surrogate Key**
- A column that represents a value that only has meaning within the context of the containing database (i.e. an autogenerated number/string used for an ID)


**Natural Key**
- A column that represents a natural value that has meaning beyond the context of the containing database and can be used to uniquely identify a row.


**Candidate Key**
- A column that can uniquely identify a row and thus is a potential candidate for a primary key.


**Composite Key** 
- A primary key consisting of multiple columns, the combination of their values being used to determine uniqueness.


**Foreign Key** 
- A column whose value represents the a unique identifier (typically a primary key) that refers to records within either in another table, or the same.


**Multiplicity** 
- A concepts the describes the minimum and maximum number of relationships between linked tables.
- Examples: 

  - _One-to-One (1:1)_
    - 1 Course has 1 Instructor
    - Usually facilitated through the use of a lookup table
    - Can also be represented by referencing another record in the same table

  - _One-to-Many (1:N)_
    - 1 Course has N Students
    - 1 Student takes N Courses
    - Can be represented by referencing another record of another table

  - _Many-to-Many (N:N)_
    - N Courses have N Students
    - Can only be properly represented through the use of a junction table


**Referential Integrity** 
- The concept of enforcing data relationships.
- No orphaned records!


**ERD** 
- Entity-Relational Diagram
- A diagrammatic representation of your database schema and the multiplicities between its tables.


**Normalization** 
- The concept of dividing data into separate tables to reduce redundancy and improve query speed
- The degree to which we normalize our database is measured by our compliance to the Normal Forms (NF).
- We usually only need to comply with 3NF, though there a ~7 Normal Forms in total.
- More notes can be found [here](https://github.com/200406-java-react-usf/demos/blob/master/notes/normalization.md)

**Procedural Language Extension of PostGreSQL (PL/pgSQL)**
- A...well, procedural language extension of the PostgreSQL dialect.
- Provides procedural constructs such as:
  - looping constructs
  - conditional flow control
  - exception handling
  - data type creation
  - function and procedure creation

---

## SQL Sublanguages

**DCL (Data Control Language)** 
- used to control access to data stored in a database
- keywords: [`GRANT`](https://www.postgresql.org/docs/11/sql-grant.html) and [`REVOKE`](https://www.postgresql.org/docs/11/sql-revoke.html)


**DDL (Data Definition Language)**
- used to define the database schema/structure
- keywords: [`CREATE`](https://www.postgresql.org/docs/11/sql-createtable.html), [`ALTER`](https://www.postgresql.org/docs/11/sql-altertable.html), [`TRUNCATE`](https://www.postgresql.org/docs/11/sql-truncate.html), [`DROP`](https://www.postgresql.org/docs/11/sql-droptable.html))


**DML (Data Manipulation Language)**
- used to manipulate the data stored within the database
- keywords: [`INSERT`](https://www.postgresql.org/docs/11/sql-insert.html), [`UPDATE`](https://www.postgresql.org/docs/11/sql-update.html), [`DELETE`](https://www.postgresql.org/docs/11/sql-delete.html)


**DQL (Data Query Language)**
- used for performing queries on the data within the database
- keyword: [`SELECT`](https://www.postgresql.org/docs/11/sql-select.html)


**TCL (Transaction Control Language)** 
- used for multiversion concurrency control (i.e. managing the transactions of multiple threads)
- keywords: [`COMMIT`](https://www.postgresql.org/docs/11/sql-commit.html), [`ROLLBACK`](https://www.postgresql.org/docs/11/sql-rollback.html), [`SAVEPOINT`](https://www.postgresql.org/docs/11/sql-savepoint.html)


---

## Table Expressions

A table expression computes a table. The table expression contains a [`FROM`](https://www.postgresql.org/docs/11/queries-table-expressions.html#QUERIES-FROM) clause that is optionally followed by [`WHERE`](https://www.postgresql.org/docs/11/queries-table-expressions.html#QUERIES-WHERE), [`GROUP BY` and `HAVING`](https://www.postgresql.org/docs/11/queries-table-expressions.html#QUERIES-GROUP) clauses. Trivial table expressions simply refer to a table on disk, a so-called base table, but more complex expressions can be used to modify or combine base tables in various ways.

---

##  Joins

A database join clause combines columns from one or more tables in a relational database. PostgreSQL's own documentation on table joins is rather sparse, but here are a few excellent resources: 
- [W3Resource](https://www.w3resource.com/PostgreSQL/postgresql-join.php).
- [PostgreSQL Tutorial](https://www.postgresqltutorial.com/postgresql-joins/)

### Types

1. Inner Joins: 
	```sql
	select * 
	from TableA 
	inner join TableB 
	on TableA.columnName = TableB.columnName;
	```
  - selects records with matching values from TableA and TableB
  - note that the `inner` keyword is optional

2. Left (Outer) Join: 
	```sql
	select * 
	from TableA a 
	LEFT JOIN TableB b 
	ON a.columnName = b.columnName;
	```
  - TableA is the primary table; selects all records from A with matching values from B (non-matching values included as null)


3. Right (Outer) Join:
	```sql
	select * 
	from TableA a 
	RIGHT JOIN TableB 
	b ON a.columnName = b.columnName;
	```
  - TableB is the primary table; selects all records from B with matching values from A (non-matching values included as null)


4. Cross Join
	```sql
	select * 
	from TableA 
	CROSS JOIN TableB;
	```
  - Creates a _"cartesian product"_ from the two tables
  - It is called a product because it returns every possible combination of rows between the joined sets.
  - If TableA has 5 rows, and TableB has 3 rows, the result set from a cross join will have 15 rows
  - Example use case: You need to figure out 

---

## Subqueries

Simply put, a subquery is a SQL query nested inside a larger query. A subquery is usually added within the WHERE Clause of another SQL SELECT statement and combined with one of several [keywords](https://www.postgresql.org/docs/11/functions-subquery.html) that act as boolean operators when used in with a subquery, that allow for power query creation. It should be noted that the inner query executes first before its parent query so that the results of an inner query can be passed to the outer query.

---

## Unions

SQL union constructs must match up possibly dissimilar types to become a single result set. The resolution algorithm is applied separately to each output column of a union query.

- `UNION`: returns distinct rows present in either return set
- `UNION ALL`: returns all rows in both sets (including duplicates)
- `INTERSECT`: returns distinct rows present in both sets
- `EXCEPT`: returns all rows present in first set but not in second

---

## Other Constructs

**Sequences** 
- Generate numeric sequence, mostl for creating/managing primary keys.


**Views** 
- A virtual table that displays the results of a `SELECT` statement, lets you reuse and store complex queries that can be used in other queries.
- Resource: [PostgreSQL Views](https://www.postgresql.org/docs/11/sql-createview.html)


**Indexes** 
- Indexes are a common way to enhance database performance, by allowing the database server to find and retrieve specific rows much faster.
- Resource: [PostgreSQL Indexes](https://www.postgresql.org/docs/11/indexes.html)


**Scalar functions** 
- used to produce a value based upon on an individual value
- Examples: `LOWER`, `UPPER`, `ABS`, `ROUND`, `CURRENT_TIMESTAMP`
- [PostgreSQL Mathematical Functions](https://www.postgresql.org/docs/11/functions-math.html)
- [PostgreSQL String Functions](https://www.postgresql.org/docs/11/functions-string.html)
- [PostgreSQL Date Functions](https://www.postgresql.org/docs/11/functions-datetime.html)


**Aggregate Functions** 
- used to produce summarized results based upon some set of data
- Examples: `AVG`, `MIN`, `MAX`, `SUM`, `COUNT`
- Resource: [PostgreSQL Aggregate Functions](https://www.postgresql.org/docs/11/functions-aggregate.html)


**Stored Functions** 
- A schema object that encapsulates some custom logic
- That takes 0 to N input parameters
- Produces 0 to 1 output values (you can technically return more than one thing using [types](https://www.postgresql.org/message-id/20030309004652.X14723-100000%40megazone23.bigpanda.com))
- Not a part of SQL, but instead part of Procedural Language Extension of PostGreSQL (PL/pgSQL)
- Custom function with 0 or many input parameters, but 0 or 1 output. DML is not allowed.
- No transactional statements are permitted within the logic of a stored function
- Resource: [PostgreSQL Stored Functions](https://www.postgresql.org/docs/11/sql-createfunction.html)

**Stored Procedures** 
- A schema object that encapsulates some custom logic
- That takes 0 to N input parameters
- Produces 0 to N output values.
- Introduced to PostgreSQL in v11
- Not a part of SQL, but instead part of Procedural Language Extension of PostGreSQL (PL/pgSQL)
- Allows for DML statements within stored procedure logic
- Allows for transactional statements within stored procedure logic
- Resource: [PostgreSQL Stored Procedures](https://www.postgresql.org/docs/11/sql-createprocedure.html)
